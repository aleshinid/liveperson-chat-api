!function(e){e.lpTag=e.lpTag||{},lpTag.CookieMethods=lpTag.CookieMethods||function(e){e&&(this.separator=e)};var t=lpTag.CookieMethods,r="prototype";t[r].separator="::",t[r].readCookie=function(e){if(!e)return"";e=encodeURIComponent(e);var t=document.cookie.split(e+"=");return 1==t.length?"":decodeURIComponent(t[1].split(";")[0])},t[r].writePersistentCookie=function(e,t,r){return r="number"==typeof r?r:2592e3,this.writeSessionCookie(e,t,r)},t[r].addToCookie=function(e,t,r){var n=this.readCookie(e);return n+=this.separator+t,"number"==typeof r?this.writeSessionCookie(e,n,r):this.writePersistentCookie(e,n,r)},t[r].writeSessionCookie=function(e,t,r){if(!e)return!1;if((null===t||void 0===t)&&(r=-1),"number"==typeof r){var n=new Date;n.setDate(n.getTime()+1e3*r)}return t=t?encodeURIComponent(t):"",document.cookie=[encodeURIComponent(e),"=",t,n?"; expires="+n.toUTCString():"","; path=/"].join(""),!0},t[r].clearCookie=function(e){return this.writeSessionCookie(e)}}(window),function(e){e.lpTag=e.lpTag||{},lpTag.StorageMethods=lpTag.StorageMethods||function(){var e=!1,t="lpTestCase";try{e="undefined"!=typeof Storage&&this.setSessionData(t,"1"),this.removeSessionData(t)}catch(r){}this.isStorageEnabled=function(){return e}};var t=lpTag.StorageMethods,r="prototype";t[r].setSessionData=function(e,t){return sessionStorage.setItem(e,t),!0},t[r].getSessionData=function(e){return sessionStorage.getItem(e)||""},t[r].removeSessionData=function(e){return this.getSessionData(e)?(sessionStorage.removeItem(e),!0):!1},t[r].setPersistentData=function(e,t){return localStorage.setItem(e,t),!0},t[r].getPersistentSessionData=function(e){return localStorage.getItem(e)||""},t[r].removePersistentData=function(e){return this.getPersistentSessionData(e)?(localStorage.removeItem(e),!0):!1}}(window),window.lpTag=window.lpTag||{},lpTag.SessionDataManager=function(){function e(e){lpTag&&lpTag.log&&lpTag.log(e,"ERROR","SessionData")}function t(t,r,n){var a=!1;if("object"!=typeof r)try{var i=n?u.getPersistentSessionData(t):u.getSessionData(t),s=""!==i?i.split(o):[];s.push(r),i=s.join(o),a=n?u.setPersistentData(t,i,n):u.setSessionData(t,i)}catch(l){e((n?"appendToPersistentData ":"appendToSessionData ")+" failed, key: "+t)}return a}function r(t,r,n){var a=!1;if("object"!=typeof r)try{for(var i=n?u.getPersistentSessionData(t):u.getSessionData(t),s=""!==i?i.split(o):[],l=[],c=0;c<s.length;c++)s[c]!==r&&l.push(s[c]);i=l.join(o),a=""!==i?n?u.setPersistentData(t,i,n):u.setSessionData(t,i):n?u.removePersistentData(t):u.removeSessionData(t)}catch(p){e((n?"removePartialPersistentData ":"removePartialSessionData ")+" failed, key: "+t)}return a}var n,a,o="::",i={},s={},u=this,l=!1;this!==window&&(n=new lpTag.StorageMethods,a=new lpTag.CookieMethods,l=n.isStorageEnabled(),this.readCookie=function(e){return a.readCookie(e)},this.setSessionData=function(t,r){r=this.stringifyValue(r);try{i[t]||(i[t]=t),l?n.setSessionData(t,r):a.writeSessionCookie(t,r)}catch(o){e("Error in setSessionData, data: "+t)}},this.getSessionData=function(t){try{return this.parseValue(l?n.getSessionData(t):a.readCookie(t))}catch(r){e("Error in getSessionData, data: "+t)}},this.stringifyValue=function(e){try{"object"==typeof e&&(e=JSON.stringify(e))}catch(t){}return e},this.parseValue=function(e){try{e=JSON.parse(e)}catch(t){}return e},this.getPersistentSessionData=function(t){try{return this.parseValue(l?n.getPersistentSessionData(t):a.readCookie(t))}catch(r){e("Error in getPersistentSessionData, data: "+t)}},this.appendToSessionData=function(e,r){t(e,r,!1)},this.appendToPersistentData=function(e,r,n){t(e,r,!0,n)},this.removePartialPersistentData=function(e,t){r(e,t,!0)},this.removeSessionData=function(e){l?n.removeSessionData(e):a.clearCookie(e)},this.removePersistentData=function(e){l?n.removePersistentData(e):a.clearCookie(e)},this.removePartialSessionData=function(e,t){r(e,t,!1)},this.setPersistentData=function(t,r,o){r=this.stringifyValue(r);try{s[t]||(s[t]=t),l?n.setPersistentData(t,r):a.writePersistentCookie(t,r,o)}catch(i){e("Error in setPersistentData, data: "+t)}},this.clearPersistentData=function(t){t=t||s;for(var r in t)try{l?n.removePersistentData(t[r]):a.clearCookie(t[r])}catch(o){e("Error in clearPersistentData, key: "+t[r])}},this.clearSessionData=function(t){t=t||i;for(var r in t)try{l?n.removeSessionData(t[r]):a.clearCookie(t[r])}catch(o){e("Error in SessionData in clearSessionData, key:"+t[r])}})},window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.utils=lpTag.utils||{},lpTag.utils.SessionDataAsyncWrapper=lpTag.utils.SessionDataAsyncWrapper||function(e){function t(e,t,r,n){var l;p?s.getValue({key:e,appName:i,site:c,success:a(e,t,n),error:a(e,r,n),context:n,domain:u}):(l=f.getSessionData(e),"undefined"!=typeof l?o(t,l,n):o(r,l,n))}function r(e,t,r,n,l){p?s.setValue({key:e,appName:i,value:t,site:c,success:a(e,r,l),error:a(e,n,l),context:l,domain:u}):f.setSessionData(e,t)?o(r,!0,l):o(n,!1,l)}function n(e,t,r,n){p?s.setValue({key:e,appName:i,site:c,success:a(e,t,n),error:a(e,r,n),context:n,domain:u,expires:-1}):f.removeSessionData(e)?o(t,!0,n):o(r,!1,n)}function a(e,t,r){return function(e){o(t,e,r)}}function o(e,t,r){try{e&&"function"==typeof e&&e.call(r,t)}catch(n){}}if(this===window)return null;var i,s,u,l=e.useSecureStorage,c=e.lpNumber,p=!1;l&&(i=e&&e.appName,s=lpTag.taglets&&lpTag.taglets.lpSecureStorage,u=e&&e.secureStorageLocation,p=l&&u&&s&&i?!0:!1),lpTag.SessionDataManager&&(lpTag.utils.sessionDataManager=lpTag.utils.sessionDataManager||new lpTag.SessionDataManager);var f=lpTag.utils.sessionDataManager||null;return{setSessionData:r,getSessionData:t,removeSessionData:n,readCookie:lpTag.utils.sessionDataManager&&lpTag.utils.sessionDataManager.readCookie,usingSecureStorage:p}},window.lpTag=window.lpTag||{},lpTag.utils=lpTag.utils||{},lpTag.utils.Events=lpTag.utils.Events||function(e){function t(e,t){for(var r=[],n=0;n<p[e].length;n++)t&&"*"!==p[e][n].appName&&p[e][n].appName!==t||r.push(p[e][n]);if(p["*"])for(var a=0;a<p["*"].length;a++)t&&"*"!==p["*"][a].appName&&p["*"][a].appName!==t||r.push(p["*"][a]);return r}function r(e,t,r){lpTag&&"function"==typeof lpTag.log&&lpTag.log(e,t,r)}function n(e,t){var n=!1;if(!t)return r("Ev listen id not spec for unregister","ERROR","Events"),null;for(var a in e)if(e.hasOwnProperty(a))for(var o=0;o<e[a].length;o++)if(e[a][o].id==t){e[a].splice(o,1),r("Ev listen="+t+" and name="+a+" unregister","DEBUG","Events"),n=!0;break}return n||r("Ev listen not found "+t+" unregister","DEBUG","Events"),n}function a(e,t,n){return function(){try{e.func.call(e.context,t,n),t=null,e.triggerOnce&&m.unbind(e),e=null}catch(a){r("Error executing "+n.eventName+" eventId: "+e.id+"e="+a.message,"ERROR","Events")}}}function o(e,t,n,a){for(var o=[],i=0;i<e.length;i++)try{var s=!n&&e[i].func===t,u=!t&&n&&e[i].context===n,l=t&&n&&e[i].func===t&&e[i].context===n,c=a&&a===e[i].appName,p="*"===e[i].appName;if(s||u||l){if(c||p)continue}else if(!t&&!n&&c)continue;o.push(e[i])}catch(f){r("Error in unbind e="+f.message,"ERROR","Events")}return o}function i(e){if(0===l||e.data&&e.data.doNotStore)return void(e=null);var t={eventName:e.eventName,appName:e.appName};t.data=e.passDataByRef?e.data:s(e.data),l>0?(g>=l&&(g=0),f[g]=t,g++):f.push(t),e=null}function s(e){var t={};if(e.constructor===Object)for(var r in e)e.hasOwnProperty(r)&&null!==e[r]&&void 0!==e[r]&&("object"==typeof e[r]&&e[r].constructor!==Array?t[r]=s(e[r]):e[r].constructor===Array?t[r]=e[r].slice(0)||[]:"function"!=typeof e[r]&&(t[r]=null!==e[r]&&void 0!==e[r]?e[r]:""));else e.constructor===Array?t=e.slice(0)||[]:"function"!=typeof e&&(t=e);return t}if(this===window)return!1;var u,l,c=0,p={},f=[],d="evId_",g=0;u=e&&"boolean"==typeof e.cloneEventData?e.cloneEventData:!1,l=e&&!isNaN(e.eventBufferLimit)?e.eventBufferLimit:-1;var m={once:function(e){return e?(e.triggerOnce=!0,void this.bind(e)):null},bind:function(e,t,n){var a=e;if("string"==typeof e&&(a={appName:e,eventName:t,func:n}),!a.eventName||!a.func||"function"!=typeof a.func&&a.func.constructor!==Array)return r("Ev listen has invalid params: evName=["+a.eventName+"]","ERROR","Events"),null;if(a.func.constructor===Array){for(var o,i,u=[],l=0;l<a.func.length;l++)o=s(a),o.func=a.func[l],i=this.register(o),u.push(i);return u}var f=d+c++,g={id:f,func:a.func,context:a.context||null,aSync:a.aSync?!0:!1,appName:a.appName||"*",triggerOnce:a.triggerOnce||!1};return p[a.eventName]=p[a.eventName]||[],p[a.eventName].push(g),r("Ev listen rgstr: evName=["+a.eventName+"] aSync="+g.aSync+" appName="+g.name,"DEBUG","Events"),a=null,e=null,f},unbind:function(e){var t,a=!1;if(!e)return r("Ev listen id not spec for unbind","ERROR","Events"),null;if("string"==typeof e)n(p,e);else if(!e.func&&!e.context&&!e.appName)return!1;var i=p;e.eventName&&(i={},i[e.eventName]=p[e.eventName]);for(var s in i)i.hasOwnProperty(s)&&(t=o(i[s],e.func,e.context,e.appName),t.length!==i[s].length&&(p[s]=t,a=!0));return a},hasFired:function(e,t){if(("undefined"==typeof t||"*"===t)&&"*"===e)return f;for(var r=[],n=0;n<f.length;n++)(f[n].eventName===t||"*"===t)&&(e&&e===f[n].appName||!f[n].appName||"*"===f[n].appName||"*"===e)&&r.push(f[n]);return r},trigger:function(e,n,o){var l=e;if("string"==typeof e&&(l={eventName:n,appName:e,data:o}),!l||"undefined"==typeof l.eventName)return r("Ev name not spec for publish","ERROR","Events"),l=null,null;if(l.passDataByRef=l.passDataByRef||!u,i(l),!p[l.eventName])return!1;var c=t(l.eventName,l.appName);if(c.length>0)for(var f=0;f<c.length;f++){var d=l.passDataByRef?l.data:s(l.data),g={appName:l.appName,eventName:l.eventName},m=c[f];m.aSync||d&&d.aSync?setTimeout(a(m,d,g),0):a(m,d,g)()}return l=null,c.length>0}};return m.publish=m.trigger,m.register=m.bind,m.unregister=m.unbind,m},window.lpTag=window.lpTag||{},lpTag.RelManager=lpTag.RelManager||function(e){function t(e,t,r){lpTag&&lpTag.utils&&lpTag.utils.log&&lpTag.utils.log(e,t,r)}function r(e,t){return e.indexOf("v=1")<0&&(e+=e.indexOf("?")>-1?"&":"?",e+="v=1"),t&&e.indexOf("&NC=true")<0&&(e+="&NC=true"),e}function n(e){if(s&&e.toLowerCase().indexOf(".json")<0){var t=e.indexOf("?");t>0?e=e.replace("?",".json?"):e+=".json"}return e}function a(e){var t="";for(var r in e)if(e.hasOwnProperty(r))if(e[r].constructor===Array)for(var n=0;n<e[r].length;n++)t+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r][n]);else t+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r]);return e=null,t}function o(e){var t=[];for(var r in e){if(e.link)return t=e.link.constructor===Array?e.link:[e.link],e=null,t;if(e.hasOwnProperty(r)&&0===t.length){if("link"===r)return t=e[r].constructor===Array?e[r]:[e[r]],e=null,t;null!==e[r]&&void 0!==e[r]&&"object"==typeof e[r]&&e[r].constructor!==Array&&(t=o(e[r]))}}return e=null,t}function i(e){var t={AUTHORIZATION:"LivePerson appKey="+c.appKey};c.accessToken&&(t={AUTHORIZATION:"Bearer "+c.accessToken});var r={url:"",method:"",headers:"",data:""};return r.url=e.url?e.url:""===e.rel?"https://"+c.domain+"/api/account/"+c.lpNumber+"?v=1":u.getURI(e.rel,{type:e.type,id:e.id,needAuth:e.needAuth}),r.url&&(r.url=n(r.url)),r.method=e.requestType||"GET",r.headers=t,t=null,"PUT"===r.method&&(r.headers["X-HTTP-Method-Override"]="PUT",r.method="POST"),"DELETE"===r.method&&(r.headers["X-HTTP-Method-Override"]="DELETE",r.method="POST"),e.data&&(r.data=e.data),e=null,r.url?r:null}if(this===window)return t("RelManager called without new","ERROR","lpTag.RelManager"),null;var s=!0,u=this,l=null,c={domain:"",lpNumber:"",appKey:"",accessToken:""},p=["xhr","postmessage","rest2jsonp"];e&&e.constructor===Array&&(p=e),this.clearData=function(){for(var e in c)c[e]="";l=null},this.setData=function(e){l={};for(var t in e)e.hasOwnProperty(t)&&(c[t]=e[t]);e&&"boolean"==typeof e.useJSON&&(s=e.useJSON),e.transportOrder&&(p=e.transportOrder),e=null},this.addRels=function(e,t){if(e=o(e),!t)return e=null,null;l[t.type]=l[t.type]||{};var r=l[t.type];t.id&&(r[t.id]=r[t.id]||{},r=r[t.id]);for(var n in e)e.hasOwnProperty(n)&&(e[n].rel?r[e[n].rel]=e[n].href:e[n]["@rel"]&&(r[e[n]["@rel"]]=e[n]["@href"]));if(t.data){r.data=r.data||{};for(var a in t.data)t.data.hasOwnProperty(a)&&(r.data[a]=t.data[a])}e=null,t=null,r=null},this.removeRels=function(e){var t=!1;return e?(e.id?l[e.type]&&l[e.type][e.id]&&(l[e.type][e.id]=null,delete l[e.type][e.id],t=!0):l[e.type]&&(l[e.type]=null,delete l[e.type],t=!0),e=null,t):null},this.hasRel=function(e,t){var r=this.getURI(e,t);return t=null,null!==r&&""!==r},this.getURI=function(e,t){if(!t||!l)return null;var n,a=null;if(l[t.type]&&(n=l[t.type],t.id&&n[t.id]&&(n=n[t.id])),n){if(a=n[e]||null,!a&&n.data)for(var o in n.data)if(n.data.hasOwnProperty(o)&&(a=this.getURI(e,{type:o,id:n.data[o],needAuth:t.needAuth})))break;t.ignoreParameters||(a=a?r(a,t.needAuth||!1):"")}return t=null,n=null,a},this.buildRequestObj=function(e){var t=i(e);return t?(e.queryParams&&t.url&&(t.url=e.queryParams?t.url+a(e.queryParams):t.url),t.transportOrder=p.slice(0),e=null,t):(e=null,t=null,null)},this.extractRels=o},window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.lpAjax=lpTag.taglets.lpAjax||function(e){function t(){m=!0}function r(t,r){e.lpTag&&lpTag.log&&lpTag.log(t,r,f)}function n(e,t){g[e]?r("Existing transport: "+e+" tried to register",v.DEBUG):(g[e]=t,r("Added transport: "+e,v.DEBUG))}function a(e){m||t();var n="unknown";try{var a=s(e);if(a)return a.issueCall(e),!0;r("No Transport found to issueCall",v.ERROR),c(v.ERROR,e.error,{responseCode:601,error:"No Transport found to issueCall, request: "+e.url,body:"ERROR"},e.context)}catch(o){a&&a.getName&&(n=a.getName()),r("Transport - "+n+" - unknown exception while issueCall",v.ERROR),c(v.ERROR,e.error,{responseCode:600,error:"Transport - "+n+" - unknown exception while issueCall: "+e.url+" e="+o,body:"ERROR"},e.context)}}function o(e){m||t();for(var r in e){var n=g[r];n&&n.configure(e[r])}}function i(e){e&&"object"==typeof e&&(e.appName=d,e.ts=(new Date).getTime(),e.tags&&e.tags.constructor===Array&&e.tags.push({pageId:h}),r(e,v.METRICS))}function s(e){for(var t=!1,r=-1,n=0;n<e.transportOrder.length;n++)if(!t){var a=l({},e),o=g[a.transportOrder[n]];o&&o.isValidRequest&&o.isValidRequest(a)&&(t=!0,r=n)}return t?g[a.transportOrder[r]]:null}function u(e,t,r){if(null!=e){var n=Array.prototype.forEach;if(n&&e.forEach===n)e.forEach(t,r);else if(e.length===+e.length){for(var a=0,o=e.length;o>a;a++)if(a in e&&t.call(r,e[a],a,e)==={})return}else for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t.call(r,e[i],i,e)==={})return}}function l(e){return u(Array.prototype.slice.call(arguments,1),function(t){for(var r in t)e[r]=t[r]}),e}function c(e,t,r,n){if("function"==typeof t)try{t.call(n||null,r),t=null}catch(a){console.log("Exception in execution of callback, type :"+e+" e=["+a.message+"]",v.ERROR,"runCallback")}else console.log("No callback, of type :"+e,v.INFO,"runCallback")}var p="1.1.3",f="lpAjax",d="lpTransporter",g={},m=!1,v={ERROR:"ERROR",DEBUG:"DEBUG",INFO:"INFO",METRICS:"METRICS"},h="lpT"+Math.floor(1e5*Math.random())+"_"+Math.floor(1e6*Math.random());return{getVersion:function(){return p},getName:function(){return f},init:t,publishMetrics:i,issueCall:a,configureTransports:o,addTransport:n}}(window),window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.postmessage=lpTag.taglets.postmessage||function(e){function t(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r)}function r(e,t){return{callId:e,responseType:t.responseType,responseCode:t.responseCode,error:{message:t.message,id:t.responseCode,name:t.name}}}function n(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)}function a(){document.body?(le=!0,o()):setTimeout(a,5)}function o(){for(;ce.length>0;)try{ce.shift().call(null)}catch(e){Q("Unable to execute queued callbacks for window interactive state: "+e,pe.ERROR,"attachPendingIFrames")}}function i(e){return e+"_"+Math.floor(1e5*Math.random())+"_"+Math.floor(1e5*Math.random())}function s(e){var t,r=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/gi),n=null;return 0!==e.indexOf("http")?location.protocol+"//"+location.host:(t=r.exec(e),t&&t.length>=3&&""!==t[2]&&(n=t[1].toLowerCase()+t[2].toLowerCase()),n)}function u(e,t){var r,n,a=!1;return e&&e.url&&"string"==typeof e.url?(r=s(e.url),n=0===e.url.toLowerCase().indexOf("https"),re[r]||ue[r]||t&&n!==t||(ue[r]=e,a=!0),a):(Q("iFrame configuration empty or missing url parameter",pe.ERROR,"queueFrame"),a)}function l(e){var t=s(e.url);if(re[t])return m(t,e.callback||e.success,e.context);var r=i("fr");return re[t]={elem:v(r),url:e.url,validated:ye.PENDING,defaults:e.defaults||{},delayLoad:isNaN(e.delayLoad)?0:e.delayLoad,requestCount:0,success:e.callback||e.success,error:e.error,maxReloadRetries:e.maxReloadRetries||3,reloadInterval:1e3*e.reloadInterval||3e4},setTimeout(function(){c(e.url,t)},re[t].delayLoad),Q("iFrame Queued to load "+t,pe.INFO,"addFrame"),ye.PENDING}function c(e,t){le?p(e,t):ce.push(function(){p(e,t)})}function p(e,r){re[r].loadCallback=re[r].loadCallback||f(r),j(re[r].elem,e),t(re[r].elem,"load",re[r].loadCallback),re[r].iFrameOnloadTimeout=setTimeout(re[r].loadCallback,5e3),re[r].attachTime=(new Date).getTime(),document.body.appendChild(re[r].elem)}function f(e){return function(t){re[e].iFrameOnloadTimeout&&(clearTimeout(re[e].iFrameOnloadTimeout),delete re[e].iFrameOnloadTimeout),re[e].loadTime=(new Date).getTime()-re[e].attachTime,T(e,t)}}function d(e){oe+=1,se+=1,re[e].requestCount=re[e].requestCount+1}function g(e,t){return ae[e]=ae[e]||[],ae[e].push(t),!0}function m(e,t,r){var n=J(e);return B(t,r,n),re[e].validated}function v(e){var t=document.createElement("IFRAME");return t.setAttribute("id",e),t.setAttribute("name",e),t.setAttribute("tabindex","-1"),t.setAttribute("aria-hidden","true"),t.setAttribute("title",""),t.setAttribute("role","presentation"),t.style.width="0px",t.style.height="0px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t}function h(e,t,r,n,a,o){var i=!1;return e&&t&&"function"==typeof t&&(ne[e]={success:t,error:r,progress:n,ctx:a,launchTime:new Date,timeout:o+1e3||he.timeout},i=!0),i}function y(e){return ne[e]?(ne[e]=null,delete ne[e],!0):!1}function T(e,t){Q("onLoad validation called "+e,pe.INFO,"validateFrame");var r=function(t){R(t,e)};return t&&t.error?R(t,e):setTimeout(function(){D({domain:e,success:r,error:r,validation:!0,timeout:100,retries:-1,defaults:re[e].defaults})},10),!0}function R(e,t){var r,n=re[t];return Q("running validation of domain "+t,pe.INFO,"validateFrameCallback"),n&&(re[t].validated=e&&e.error?ye.FAILED:ye.VALIDATED,r=re[t].validated===ye.VALIDATED,r?b(t,e):re[t].reloadObj&&re[t].reloadObj.retriesLeft>0?N(t):S(t)),n=null,r}function b(e,t){var r;Q("FrameLoaded "+e,pe.INFO,"runFrameValidated"),r=x(me);for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);B(re[e].success,re[e].context,r),G(e),E(e,!0)}function S(e){if(Q("iFrame is a teapot "+e,pe.ERROR,"runFrameFailedToLoad"),re[e].error){var t=r(0,ve);t.domain=e,B(re[e].error,re[e].context,t)}O(e),E(e,!1)}function N(e){Q("Retry loading domain: "+e,"info","runReloadAttempt"),E(e,!1),U(e)}function E(e,t){if(Q("Running buffer queue : "+e+" loaded: "+t,pe.INFO,"runQueuedRequests"),ae[e]&&ae[e].length>0){do{var r=ae[e].shift();t?D(r):B(r.error,r.context,{responseCode:600,error:"Transport - postmessage - unable to run request: "+e,body:"ERROR"})}while(ae[e].length>0);ae[e]=null,delete ae[e]}}function O(e){if(Q("Cleaning up failed iFrame: "+e,pe.INFO,"cleanupIFrame"),re[e]){n(re[e].elem,"load",re[e].loadCallback),re[e].elem.parentNode.removeChild(re[e].elem);var t=x(ve);t.domain=e,t.url=re[e].url,B(re[e].error,re[e].context,t),re[e]=null,delete re[e]}}function I(e,t,r){return Q("Frame not found for domain: "+e,pe.ERROR,"noFrameFound"),B(t,{responseCode:600,error:"Transport - postmessage - unable to run request: "+e,body:"ERROR"},r),!1}function C(t){var r=!1;return e.postMessage&&e.JSON&&t&&t.success&&(t.domain&&t.validation||t.url)&&(t.domain=t.domain||s(t.url),(re[t.domain]||ue[t.domain])&&(r=!0)),r}function D(e){var t=!1;return te&&C(e)?re[e.domain]?re[e.domain].validated!==ye.PENDING||e.validation?(t=A(e),t?d(e.domain):ne[e.callId].timeout=0):t=g(e.domain,e):(Q("Adding iFrame to DOM - first request: "+e.domain,pe.INFO,"issueCall"),t=g(e.domain,e),l(ue[e.domain]),delete ue[e.domain]):t=I(e.domain,e.error,e.context),t}function A(e){var t,r=!1;e=P(e),t=x(e);try{t=q(t)}catch(n){return Q("Error trying to stringify message",pe.ERROR,"sendMessageToFrame"),!1}Q("sending msg to domain "+e.domain,pe.DEBUG,"sendMessageToFrame");var a=e.timeout*(e.retries+1)+2e3;h(e.callId,e.success,e.error,e.progress,e.context,a);try{r=w(e.domain,t),z=setTimeout(k,1e3)}catch(n){Q("Error trying to send message: "+n,pe.ERROR,"sendMessageToFrame"),r=!1}return r}function q(e){var t;if("function"==typeof Array.prototype.toJSON){var r=Array.prototype.toJSON;delete Array.prototype.toJSON;try{t=JSON.stringify(e)}catch(n){throw Array.prototype.toJSON=r,n}Array.prototype.toJSON=r}else t=JSON.stringify(e);return t}function P(t){var r=re[t.domain]&&re[t.domain].defaults;return t.callId=i("call"),t.returnDomain=fe,"undefined"==typeof t.timeout&&(t.timeout=r&&r.timeout||he.timeout),"undefined"==typeof t.retries&&(t.retries=r&&"undefined"!=typeof r.retries?r.retries:he.retries),t.progress&&(t.fireProgress=!0),t.headers=t.headers||{},t.headers["LP-URL"]=e.location.href,t}function w(e,t){var r=!1;try{re[e].elem.contentWindow.postMessage(t,e),r=!0}catch(n){Q("Error trying to send message: "+n,pe.ERROR,"postTheMessage")}return r}function k(){z&&clearTimeout(z),z=null;var e=new Date,t=0,n=[];for(var a in ne)if(ne.hasOwnProperty(a)&&ne[a].launchTime){var o=e-ne[a].launchTime;o>ne[a].timeout?n.push(a):t+=1}if(n.length){Q("Checking errors found "+n.length+" timeout callbacks to call",pe.DEBUG,"checkForErrors");for(var i=0;i<n.length;i++)L(r(n[i],ge))}return t>0&&(z=setTimeout(k,1e3)),!0}function x(e){var t={};if(e.constructor===Object)for(var r in e)try{e.hasOwnProperty(r)&&"function"!=typeof e[r]&&(t[r]=e[r])}catch(n){Q("Error creating request object data clone: "+n,pe.ERROR,"cloneSimpleObj")}else e.constructor===Array?t=e.slice(0)||[]:"function"!=typeof e&&(t=e);return t}function L(e,t){var r,n=ne[e.callId],a=e.responseType,o=!1;if(e.callId&&ne[e.callId]||e.responseType===de.reloading||e.responseType===de.stats)try{switch(a){case de.completed:r=n.success,o=!0;break;case de.error:r=n.error,o=!0,ie+=1;break;case de.progress:r=n.progress;break;case de.reloading:e=t,r=U;break;case de.stats:r=Z,e=e.rawData}o&&(y(e.callId),K(e),se=se>=0?0:se-1),r&&"function"==typeof r&&B(r,n&&n.ctx||null,e),r=null,n=null}catch(i){return Q("Error in executing callback: "+i,pe.ERROR,"executeMessageCallback"),!1}return!0}function U(e){Q("Got reload request from "+e,pe.INFO,"handleReload"),re[e].validated=ye.PENDING,re[e].reloadObj||(Q("Creating reloadObj"+e,pe.DEBUG,"handleReload"),re[e].reloadObj=V(e)),M(e)}function M(e){Q("Reload try for domain "+e+" ,retries left "+re[e].reloadObj.retriesLeft,pe.INFO,"reloadIFrame"),re[e].reloadObj.retriesLeft=re[e].reloadObj.retriesLeft-1,re[e].reloadObj.setLocationTimeout&&clearTimeout(re[e].reloadObj.setLocationTimeout),re[e].reloadObj.retry?re[e].reloadObj.setLocationTimeout=setTimeout(F(e),re[e].reloadInterval):(re[e].reloadObj.retry=!0,F(e)())}function F(e){return function(){re[e].iFrameOnloadTimeout=setTimeout(function(){T(e,{error:{code:404,message:"Frame did not trigger load"}})},5e3),j(re[e].elem,re[e].url)}}function j(e,t){t+=t.indexOf("?")>0?"&bust=":"?bust=",t+=(new Date).getTime(),t+="&loc="+location.protocol+"//"+location.host,Q("Setting iFrame to URL: "+t,pe.INFO,"setIFrameLocation"),e.setAttribute("src",t)}function V(e){Q("Creating reload object "+e,pe.INFO,"createReloadObject");var t=re[e].maxReloadRetries;return{retriesLeft:t}}function G(e){Q("Cleaning up reload object for this instance"+e,pe.INFO,"cleanUpReloadObject"),re[e].reloadObj&&(re[e].reloadObj.setLocationTimeout&&clearTimeout(re[e].reloadObj.setLocationTimeout),re[e].reloadObj=null,delete re[e].reloadObj)}function K(e){for(var t=["callId","responseType"],r=0;r<t.length;r++)e[t[r]]=null,delete e[t[r]]}function J(e){return e&&re[e]?{url:re[e].url,validated:re[e].validated,requestCount:re[e].requestCount,defaults:x(re[e].defaults),started:re[e].validated===ye.VALIDATED}:{}}function H(){var e={};for(var t in re)re.hasOwnProperty(t)&&(e[t]=J(t));return e}function B(e,t,r){if(e&&"function"==typeof e)try{e.call(t||null,r)}catch(n){Q("Error in executing callback: "+n,pe.ERROR,"runCallback")}}function W(e){var t,r;try{if(r=e.origin,!re[r])return;t=_(e.data),t.body=_(t.body)}catch(n){t=null,Q("Error in handling message from frame:"+n+" origin: "+r,pe.ERROR,"handleMessage")}t&&"object"==typeof t&&L(t,r)}function _(e){var t;if("string"==typeof e)try{t=JSON.parse(e)}catch(r){Q("Error in parsing string: "+e,pe.DEBUG,"parseJSONString")}else t=e;return t}function Q(t,r,n){e.lpTag&&lpTag.log&&lpTag.log(t,r,n)}function X(e){var t=0===location.protocol.indexOf("https");if(e){if(e.frames){e.frames=e.frames.constructor===Array?e.frames:[e.frames];for(var r=0;r<e.frames.length;r++)u(e.frames[r],t)}if(e.defaults)for(var n in e.defaults)he.hasOwnProperty(n)&&e.defaults.hasOwnProperty(n)&&(he[n]=e.defaults[n])}te=!0}function Y(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax)try{lpTag.taglets.lpAjax.addTransport(ee,Te)}catch(e){}}function Z(e){lpTag.taglets.lpAjax&&lpTag.taglets.lpAjax.publishMetrics&&(e.tags&&e.tags.constructor===Array&&e.tags.push({transport:ee}),lpTag.taglets.lpAjax.publishMetrics(e))}var z,$="1.1.8",ee="postmessage",te=!0,re={},ne={},ae={},oe=0,ie=0,se=0,ue={},le=!1,ce=[],pe={DEBUG:"DEBUG",INFO:"INFO",ERROR:"ERROR"},fe=s(document.location.href),de={progress:"progressLoad",completed:"completeLoad",error:"errorLoad",reloading:"reloading",stats:"statData"},ge={responseType:de.error,responseCode:404,message:"Request timed out on parent postMessage layer",name:"TIMEOUT"},me={responseType:de.success,responseCode:200,message:"iFrame has successfully loaded",name:"OK"},ve={responseType:de.error,responseCode:418,message:"This iFrame is a teapot, not very useful for communication but lovely for earl grey",name:"TEAPOT"},he={timeout:6e4,metricsCount:1e3};a(),t(e,"message",W);var ye={VALIDATED:"valid",PENDING:"pending",FAILED:"failed"},Te={init:Y,issueCall:D,isValidRequest:C,getVersion:function(){return $},getName:function(){return ee},configure:X,getFrameData:J,inspect:function(){return{name:ee,version:$,callsMade:oe,errorsFound:ie,pending:se,defaults:he,iFrameList:x(ue),activeFrames:H()}}};return Y(),Te}(window),window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.jsonp=lpTag.taglets.jsonp||function(e){function t(e){if("string"==typeof e){var t=e;e={url:t}}return e.url?(e.encoding=e.encoding||w.encoding,e.callback=e.callback||w.callback,e.retries="number"==typeof e.retries?e.retries:w.retries,e.timeout=e.timeout?e.timeout:w.timeout,e):!1}function r(){return Math.round(99999*Math.random())+"x"+Math.round(99999*Math.random())}function n(e,t){return{statusCode:e,responseCode:e,error:t,body:"ERROR"}}function a(){return"scr"+Math.round(999999999*Math.random())+"_"+Math.round(999999999*Math.random())}function o(t){var r=!1;if(x&&t&&t.url){var n=W,a=!1;t.callbackName&&"string"==typeof t.callbackName&&(n=t.callbackName.length,(B[t.callbackName]||e[t.callbackName])&&(a=!0));var o;try{o=4+(t.callback||w.callback).length+t.url.length+n+i(t.data).length+i(t.query).length}catch(s){I("Could not evaluate the length  of the request, e="+s,k.ERROR,"isValidRequest"),r=!1}"undefined"!=typeof o&&U>o&&!a&&(r=!0)}return r}function i(e){var t="";if("string"==typeof e)t+=e;else{var r=!0;for(var n in e){var a;"object"==typeof e[n]?a=s(e[n]):"function"!=typeof e[n]&&(a=e[n]),"undefined"!=typeof a&&(r||(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(a),r=!1)}}return t}function s(e){var t;if("function"==typeof Array.prototype.toJSON){var r=Array.prototype.toJSON;delete Array.prototype.toJSON;try{t=JSON.stringify(e)}catch(n){throw Array.prototype.toJSON=r,n}Array.prototype.toJSON=r}else t=JSON.stringify(e);return t}function u(e){var a;return o(e)?(e=t(e),e.callbackName&&"string"==typeof e.callbackName?e.retries=0:e.callbackName=M+r(),a=e.url+(e.url.indexOf("?")>-1?"&":"?")+e.callback+"="+e.callbackName,e.data&&(a+="&"+i(e.data)),e.query&&(a+="&"+i(e.query)),e.callUrl=a,l(e)?(O(e),c()):I("URL request was too long and was not sent, url: "+a,k.ERROR,"issueCall"),!0):(I("URL request was too long or static callback name already exists, url: "+a,k.ERROR,"issueCall"),g(),e&&e.error&&N(k.ERROR,e.error,n(600,"Transport - JSONP - unable to run request: "+e.url),e.context),!1)}function l(t){var r,n=!1,a=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/gi);if(r=a.exec(0===t.callUrl.indexOf("http")?t.callUrl:e.location.href),r&&r.length>=3&&""!==r[2]){var o=r[2].toLowerCase();t.domainMatch=o,F[o]=F[o]||[],F[o].inFlight=F[o].inFlight||0,F[o].push(t),n=!0,V+=1,I("buffered URL: "+t.callUrl,k.DEBUG,"lpTag.taglets.jsonp.bufferRequest")}else I("NO MATCH for URL: "+t.callUrl,k.ERROR,"lpTag.taglets.jsonp.bufferRequest");return n}function c(){var e;for(var t in F)if(F.hasOwnProperty(t)){e=F[t];for(var r=!1;!r&&e.inFlight<6&&e.length>0;){var n=e.shift();n?(I("Sent URL: "+n.callUrl,k.DEBUG,"lpTag.taglets.jsonp.sendRequests"),n.scriptId=f(n.callUrl,n.encoding,n.callbackName),n.startTime=(new Date).getTime(),d(t,n.callbackName,n.timeout),V-=1):r=!0}}e=null}function p(){clearTimeout(q),q=null;var t=new Date;for(var r in B)if(B.hasOwnProperty(r)&&B[r].launchTime){var a=t-B[r].launchTime;(B[r].loadTime||a>B[r].timeout)&&e[r].apply(null,[n(408,{message:"Request timed out",name:"timeout"}),!0])}G>0&&(q=setTimeout(p,1e3))}function f(t,r,n){var o=a(),i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("charset",r),i.onload=function(){B[n]&&(B[n].loadTime=new Date),this.onload=this.onerror=this.onreadystatechange=null},e.addEventListener?i.onerror=function(){B[n]&&(B[n].loadTime=new Date),this.onload=this.onerror=this.onreadystatechange=null}:i.onreadystatechange=function(){this.readyState&&("loaded"===this.readyState||"complete"===this.readyState)&&(B[n]&&(B[n].loadTime=new Date),this.onload=this.onerror=this.onreadystatechange=null)},i.setAttribute("src",t),i.setAttribute("id",o),document.getElementsByTagName("head")[0].appendChild(i),q||(q=setTimeout(p,1e3)),i=null,o}function d(e,t,r){F[e].inFlight=F[e].inFlight+1,B[t]={launchTime:new Date,timeout:r},G+=1,j+=1}function g(){K+=1}function m(e){for(var t;t=document.getElementById(e);)try{t.parentNode.removeChild(t);for(var r in t)t.hasOwnProperty(r)&&delete t[r]}catch(n){I("error when removing script",k.ERROR,"removeScript")}}function v(e){F[e].inFlight=F[e].inFlight-1,G-=1}function h(e,t,r){R(t.startTime,t.url,r),m(t.scriptId),v(t.domainMatch),E(t.callbackName,r),r?(t.callbackName&&(t.callbackName=null,delete t.callbackName),b(e,t)):(S(t),N("callback",t.success,e,t.context),t=null,c())}function y(){var e;lpTag.taglets.lpAjax&&lpTag.taglets.lpAjax.publishMetrics&&H.length>0&&(e={tags:[{transport:Q}],metrics:H},lpTag.taglets.lpAjax.publishMetrics(e),H.length=0),T()}function T(){P&&clearTimeout(P),P=setTimeout(y,w.metricsTimeout)}function R(e,t,r){var n,a;e&&(a=(new Date).getTime(),n=a-e,H.push({rd:n,ts:e,url:t,method:"GET",statusCode:r?400:200}),H.length>=w.metricsCount&&y())}function b(e,t){J+=1,t.retries>0?(t.retries=t.retries-1,u(t)):(S(t),N(k.ERROR,t.error,e||n(408,{id:408,name:"TIMEOUT",message:"Request has timed out on all retries"}),t.context),t=null,c())}function S(e){for(var t=["callUrl","retries","id","requestTimeout","type","encoding","launchTime","callbackName","domainMatch","startTime"],r=0;r<t.length;r++)e.hasOwnProperty(t[r])&&(e[t[r]]=null,delete e[t[r]])}function N(e,t,r,n){if("function"==typeof t)try{t.call(n||null,r),t=null}catch(a){I("Exception in execution of callback, type :"+e+" e=["+a.message+"]",k.ERROR,"runCallback");

}else I("No callback, of type :"+e,k.INFO,"runCallback")}function E(t,r){if(B[t]=null,delete B[t],r===!0)e[t]=function(){e[t]=null;try{delete e[t]}catch(r){}};else{e[t]=null;try{delete e[t]}catch(n){}}}function O(t){B[t.callbackName]?(g(),b(n(409,{message:"This callbackName is already in a pending request and can't be serviced",id:409,name:"CONFLICT"}),t)):e[t.callbackName]=function(e,r){h(e,t,r)}}function I(t,r,n){(L===!0||r===k.ERROR)&&e.lpTag&&lpTag.log&&lpTag.log(t,r,n)}function C(e){if(e){for(var t in e)w.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(w[t]=e[t]);L="boolean"==typeof e.debugMode?e.debugMode:L}D()}function D(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax)try{lpTag.taglets.lpAjax.addTransport(Q,X)}catch(e){}T()}function A(){var e={};for(var t in w)w.hasOwnProperty(t)&&(e[t]=w[t]);return e}var q,P,w={callback:"cb",encoding:"UTF-8",timeout:1e4,retries:2,metricsCount:100,metricsTimeout:6e4},k={ERROR:"ERROR",DEBUG:"DEBUG",INFO:"INFO"},x=!0,L=!1,U=2083,M="lpCb",F={},j=0,V=0,G=0,K=0,J=0,H=[],B={},W=r().length,_="1.1.7",Q="jsonp",X={init:D,configure:C,issueCall:u,isValidRequest:o,getVersion:function(){return _},getName:function(){return Q},getDefaults:A,inspect:function(){return{name:Q,version:_,callsMade:j,errorsFound:J,pending:G,buffered:V,refused:K,defaults:A()}}};return D(),X}(window),window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.xhr=lpTag.taglets.xhr||function(e){function t(e){if(e&&e.defaults)for(var t in e.defaults)e.defaults.hasOwnProperty(t)&&H.hasOwnProperty(t)&&(H[t]=e.defaults[t]);M(),oe=!0}function r(e){return e.method=e.method||H.method,e.encoding=e.encoding||H.encoding,e.mimeType=e.mimeType||H.mimeType,e.retries=isNaN(e.retries)?H.retries:e.retries,e.timeout=isNaN(e.timeout)?H.timeout:e.timeout,e.XMLHTTPOverride="boolean"==typeof e.XMLHTTPOverride?e.XMLHTTPOverride:H.XMLHTTPOverride,e.cache="boolean"==typeof e.cache?e.cache:H.cache,e.asynch="boolean"==typeof e.asynch?e.asynch:H.asynch,e.method.toLowerCase()!==G.PUT.toLocaleLowerCase()&&e.method.toLowerCase()!==G.DELETE.toLocaleLowerCase()||!e.XMLHTTPOverride||(e.headers[X]=e.method,e.method=G.POST),e}function n(e){var t=e.url.indexOf("__d=");t>-1&&(e.url=e.url.substr(0,t-1)),!e.cache&&(e.method.toLowerCase()!==G.GET.toLowerCase()||e.url.length<=$-10)&&(e.url+=e.url.indexOf("?")>0?"&__d=":"?__d=",e.url+=Math.floor(1e5*Math.random()))}function a(e){e=r(e);var t=!1;if(e&&e.url&&"string"==typeof e.url&&Q==i(e.url))if(e.method&&e.method.toLowerCase()!==G.GET.toLowerCase())t=!0;else{var n=$,a="";0!==e.url.indexOf("http")&&(e.url=o(e.url));try{e.query&&(a=v(e.query)),e.data&&(a+=v(e.data))}catch(s){b("Error stringifying data",J.ERROR),t=!1}e.cache||(n-=10),e.url.length+1+a.length<=n&&(t=!0)}return oe&&t}function o(e){var t=document.location.href.lastIndexOf("/")||document.location.href.lastIndexOf("?"),r=document.location.href.substr(0,t);return e=r+"/"+e}function i(t){var r,n=new RegExp(/(http{1}s{0,1}?:\/\/)([^\/\?]+)(\/?)/gi),a=null;return r=n.exec(0===t.indexOf("http")?t:e.location.href),r&&r.length>=3&&""!==r[2]&&(a=r[1].toLowerCase()+r[2].toLowerCase()),a}function s(e,t,r){if(t=t||{},t["Content-Type"]=u(t["Content-Type"]||H.mimeType,r.encoding),t.Accept=t.Accept||H.acceptHeader,t["X-Requested-With"]="XMLHttpRequest",t)for(var n in t)if(t.hasOwnProperty(n))try{e.setRequestHeader(n,t[n])}catch(a){}return e}function u(e,t){var r=e;return(!r||""==r||r.indexOf("charset")<0)&&(r=(r||H.MIMETYPE)+"; charset="+(t||H.encoding)),r}function l(e){a(e)?d(e):e&&e.error&&R(e.error,Z,e.context)}function c(e){var t=z?N(e):S(e);t.overrideMimeType&&t.overrideMimeType(e.mimeType);try{e.query&&(e.url=p(e.url,e.query),e.query=null),e.method===G.GET&&e.data?(e.url=p(e.url,e.data),e.data=null):"undefined"!=typeof e.data&&(e.data=y(e.data))}catch(r){return m(e,t,!1,{responseCode:601,HTTPStatus:"Unable to service request",headers:"",body:{error:"unable to stringify data for requests"}}),!1}return n(e),e.xhr=t,t.open(e.method,e.url,e.asynch),t=s(t,e.headers,e),f(e),t.send(e.data||null),j||setTimeout(g,1e3),!0}function p(e,t){var r;return r=v(t),r&&(e+=e.indexOf("?")<0?"?":"&",e+=r),e}function f(e){e.launchTime=new Date,ne.push(e),w()}function d(e){re.push(e),T()}function g(){j&&(clearTimeout(j),j=null);for(var e=new Date,t=[],r=0;r<ne.length;r++){var n=ne[r],a=e.valueOf()-n.launchTime.valueOf();a>n.timeout&&(m(n,n.xhr,!0),t.push(n))}for(var o=0;o<t.length;o++)k(t[o]),t[o]=null;(re.length>0||ne.length>0)&&(j=setTimeout(g,1e3))}function m(e,t,r,n){if(P(),e.launchTime&&x(e.launchTime.getTime(),e.url,e.method,n&&n.responseCode||408),r||k(e),h(e),r&&t)try{t.abort()}catch(a){b("Error when trying to abort request "+e.url,J.ERROR)}t&&E(t),e.retries>0&&!n?(e.retries=e.retries-1,d(e)):R(e.error,n||Y,e.context)}function v(e){var t="";if("string"==typeof e)t+=e;else{var r=!0;for(var n in e){var a;"object"==typeof e[n]?a=JSON.stringify(e[n]):"function"!=typeof e[n]&&(a=e[n]),"undefined"!=typeof a&&(r||(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(a),r=!1)}}return t}function h(e){for(var t=["xhr"],r=0;r<t.length;r++)e[t[r]]=null,delete e[t[r]]}function y(e){return"object"==typeof e?JSON.stringify(e):"string"==typeof e?e:""}function T(){for(;ne.length<6&&re.length>0;)c(re.shift())}function R(e,t,r){if(e&&"function"==typeof e)try{e.call(r,t)}catch(n){b(n.message)}}function b(t,r){e.lpTag&&lpTag.log&&lpTag.log(t,r,W)}function S(t){var r=new e.XMLHttpRequest;return r.addEventListener(K.LOAD,function(){t&&!t.completed?(A(this,t),t.completed=!0):t=null}),r.addEventListener(K.PROGRESS,function(){var e=O(this);e&&t.progress&&R(t.progress,e,t.context)}),r.addEventListener(K.ERROR,function(){t&&!t.completed?(q(this,t),t.completed=!0):t=null}),r.addEventListener(K.READYSTATE,function(){this.readyState===B.COMPLETE&&(t&&!t.completed?(A(this,t),t.completed=!0):t=null)}),r}function N(t){var r=new e.XMLHttpRequest;return r[K.READYSTATE]=function(){t.completed||this.readyState===B.COMPLETE&&(A(this,t),t.completed=!0)},r[K.ERROR]=function(){q(this,t)},r}function E(e){e[K.READYSTATE]=null,e[K.ERROR]=null,z||(e[K.PROGRESS]=null,e[K.LOAD]=null),e=null}function O(e){var t,r;if(!e)return b("No data from request",J.INFO),{};try{r=C(e),t={responseCode:I(e,"status")||404,HTTPStatus:I(e,"statusText"),body:I(e,"responseText","string")||I(e,"responseXML"),headers:r.headers,originalHeader:r.originalHeader}}catch(n){return b(n.message,J.ERROR),{}}if(t&&t.headers&&t.headers["Content-Type"]&&t.headers["Content-Type"]===V.JSON)try{t.body=JSON.parse(t.body)}catch(n){}return t.responseCode=1223==t.responseCode?204:t.responseCode,t.responseCode>=12e3&&(t.internalCode=t.responseCode,t.responseCode=500),t.statusCode=t.responseCode,t}function I(e,t,r){try{return r?typeof e[t]===r?e[t]:"":e[t]}catch(n){return""}}function C(e){var t,r={};try{t=e.getAllResponseHeaders()}catch(n){t=""}if(t)for(var a=t.split("\n"),o=0;o<a.length;o++)try{var i=a[o].split(":");if(i[0]){var s=i.length>2?i.slice(1).join(":"):i[1];r[D(i[0])]=D(s)}}catch(n){}return{originalHeader:t,headers:r}}function D(e){return e&&"string"==typeof e&&(e=e.replace(/^[\s\r]*/,""),e=e.replace(/[\s\r]*$/g,"")),e}function A(e,t){h(t);var r=O(e);if(t.launchTime&&x(t.launchTime.getTime(),t.url,t.method,r.responseCode),r){var n;r.responseCode>399?m(t,e,!1,r):(k(t),n=t.success,R(n,r,t.context),E(e))}T()}function q(e,t){m(t,e),T()}function P(){te+=1}function w(){ee+=1}function k(e){for(var t=0;t<ne.length;t++)if(ne[t]===e){ne.splice(t,1);break}}function x(e,t,r,n){var a,o;e&&(o=(new Date).getTime(),a=o-e,ae.push({rd:a,ts:e,url:t,method:r,statusCode:n}),ae.length>=H.metricsCount&&L())}function L(){var e;lpTag.taglets.lpAjax&&lpTag.taglets.lpAjax.publishMetrics&&ae.length>0&&(e={tags:[{transport:W}],metrics:ae},lpTag.taglets.lpAjax.publishMetrics(e),ae.length=0),U()}function U(){F&&clearTimeout(F),F=setTimeout(L,H.metricsTimeout)}function M(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax&&lpTag.taglets.lpAjax.addTransport)try{lpTag.taglets.lpAjax.addTransport(W,ie)}catch(e){}U()}var F,j,V={JSON:"application/json",JAVASCRIPT:"text/javascript",HTML:"text/html",XMLAPP:"application/xml",XMLTEXT:"text/xml",FORM:"application/x-www-form-urlencoded;"},G={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},K={PROGRESS:"progress",LOAD:"load",ERROR:"error",ABORT:"abort",READYSTATE:"readystatechange"},J={ERROR:"ERROR",DEBUG:"DEBUG",INFO:"INFO"},H={encoding:"UTF-8",method:G.GET,asynch:!0,timeout:3e4,mimeType:V.JSON,cache:!1,acceptHeader:"*/*",XMLHTTPOverride:!0,retries:2,metricsCount:100,metricsTimeout:6e4},B={UNSENT:0,OPENED:1,HEADERS_RECIEVED:2,LOADING:3,COMPLETE:4},W="xhr",_="1.1.6",Q=i(document.location.href),X="X-HTTP-Method-Override",Y={responseCode:404,HTTPStatus:"bad request",body:{error:"Request timed out"},headers:""},Z={responseCode:600,HTTPStatus:"unable to service request",body:{error:"Transport - "+W+" - unable to run request"},headers:""},z=!e.addEventListener,$=2083,ee=0,te=0,re=[],ne=[],ae=[],oe=!0;z&&(K.READYSTATE="on"+K.READYSTATE,K.ERROR="on"+K.ERROR);var ie={init:M,configure:t,issueCall:l,isValidRequest:a,getVersion:function(){return _},getName:function(){return W},inspect:function(){return{name:W,version:_,callsMade:ee,errorsFound:te,pending:ne.length,defaults:function(){var e={};for(var t in H)H.hasOwnProperty(t)&&(e[t]=H[t]);return e}()}}};return M(),ie}(window),window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.taglets.rest2jsonp=lpTag.taglets.rest2jsonp||function(){function e(e){for(var r in k)k.hasOwnProperty(r)&&(e[r]=e[r]||k[r]);return e.data=t(e),e.url=L+O(e.data.u),e}function t(e){return{u:r(e.url),m:e.method||k.method,b:e.data||"",h:e.headers||""}}function r(e){return e&&e.indexOf(".json?")&&(e=e.replace(".json?","?")),e}function n(e){return e&&"string"==typeof e.url&&"function"==typeof e.success&&U.site&&U.domain&&L?!0:!1}function a(e,t,r){lpTag&&lpTag.log&&lpTag.log(e,t,r)}function o(){return Math.round(9999999999*Math.random())+"-"+Math.round(9999999999*Math.random())}function i(e){return e?encodeURIComponent(s(e)):""}function s(e){var t;if("function"==typeof Array.prototype.toJSON){var r=Array.prototype.toJSON;delete Array.prototype.toJSON;try{t=JSON.stringify(e)}catch(n){throw Array.prototype.toJSON=r,n}Array.prototype.toJSON=r}else t=JSON.stringify(e);return t}function u(){var e=0;for(var t in V)V.hasOwnProperty(t)&&(e+=("&"+V[t]+"=99").length);return e+=C.length+k.callback.length+M.length+G}function l(){var e=0;for(var t in j)j.hasOwnProperty(t)&&(e+=("&"+j[t]+"=99").length);return e+=3,e+=F}function c(e,t){var r=e.url+(e.url.indexOf("?")>-1?"&":"?")+V.VERSION_PARAM+"="+D+"&"+V.JSON+"="+M;if(t){var n=i(e.data);n&&(r+="&"+V.BODY_PARAM+"="+n)}return r}function p(e){return e.url.length+J+i(e.data).length>K}function f(e,t,r,n){if("function"==typeof t)try{t.call(n||null,r)}catch(o){a("Exception in execution of callback, type :"+e+" e=["+o.message+"]","ERROR","lpTag.JSONP.runCallback")}else a("No callback, of type :"+e,"INFO","lpTag.JSONP.runCallback")}function d(e,t){var r={};return r.encoding=e.encoding,r.timeout=e.timeout||k.timeout,r.callback=e.callback||k.callback,r.retries="number"==typeof t?t:0,r}function g(e){e.id=o(),B[e.id]={originalRequest:e,index:0,baseUrl:c(e,!1),urls:T(e.url,i(e.data),e.id),interimObj:d(e)},m(B[e.id].interimObj,B[e.id])}function m(e,t){e.url=y(t),e.id=t.id+"!"+t.index,e.success=function(r){!r||200!==r.responseCode&&201!==r.responseCode?(t.originalRequest.error.apply(null,[r]),h(t.id),N()):(r&&r.lpMeta&&r.lpMeta.lpS&&(t.secureId=r.lpMeta.lpS),t.index+1<t.urls.length?(t.index++,m(e,t)):(t.originalRequest.success.apply(null,[r]),h(t.id))),S()},e.error=e.success,lpTag.taglets.jsonp.issueCall(e),b()}function v(e){var t=d(e,e.retries||k.retries);t.id=o(),t.url=c(e,!0),t.success=function(r){r.responseCode&&200===r.responseCode||201===r.responseCode?f("CALLBACK",e.success,r,e.context):(f("ERROR",e.error,r,e.context),N()),t=null,e=null,S()},t.error=function(r){f("ERROR",e.error,r,e.context),t=null,e=null,S(),N()},lpTag.taglets.jsonp.issueCall(t),b()}function h(e){B[e]=null,delete B[e]}function y(e){return e.baseUrl+"&"+j.PART_PARAM+"="+(e.index+1)+"&"+j.OUTOF_PARAM+"="+e.urls.length+(e.secureId?"&"+j.SECURE_IDENTIFIER+"="+e.secureId:"")+"&"+V.BODY_PARAM+"="+e.urls[e.index]}function T(e,t,r){e+="&"+V.CALLID+"="+r;var n=K-e.length-H-J;return R(n,t)}function R(e,t){function r(e,t,r,n,a){e+=n>0?"%":"";var o=a-e.length;return e+=t.substring(0,o),r.push(e),t=t.substring(o,t.length)}function n(e,t,r){for(var n=Math.ceil(e.length/t),a=0;n>a;a++){var o=e.substring(a*t,(a+1)*t);n>a+1&&r.push(o)}return o}function a(e,t,r,n,a){var o=(e+t).length;return o+=a>0?1:0,o>r&&(n.push(e),e=""),e+=a>0?"%":"",e+=t}var o,i="",s=[],u=t.split("%");for(o=0;o<u.length;o++)u[o].length>e?(u[o]=r(i,u[o],s,o,e),i="",i=n(u[o],e,s)):i=a(i,u[o],e,s,o);return""!==i&&s.push(i),s}function b(){q+=1,w+=1}function S(){w=w>0?w-1:0}function N(){P+=1}function E(t){return n(t)?(t=e(t),p(t)?g(t):v(t)):!1}function O(e){var t="";return-1!=e.indexOf("/agentSession")?t="/agentSession":-1!=e.indexOf("/chat")?t="/chat":-1!=e.indexOf("/visit")?(t="/visit",-1!=e.indexOf("/keepAlive")&&(t+="/keepAlive")):-1!=e.indexOf("/configuration")&&(t="/configuration"),t}function I(e){for(var t in e)e.hasOwnProperty(t)&&(k.hasOwnProperty(t)?k[t]=e[t]:U.hasOwnProperty(t)&&(U[t]=e[t]));U.domain&&U.site&&(L=x.prefix+U.domain+x.middle+U.site+x.suffix)}var C="1.1",D="1",A="rest2jsonp",q=0,P=0,w=0,k={retries:3,method:"GET",timeout:3e4,encoding:"UTF-8",callback:"cb"},x={prefix:"https://",middle:"/api/account/",suffix:"/js2rest"},L="",U={site:"",domain:""},M="1",F=32,j={PART_PARAM:"lpP",OUTOF_PARAM:"lpO",SECURE_IDENTIFIER:"lpS"},V={VERSION_PARAM:"lpV",BODY_PARAM:"lpB",JSON:"lpjson",CALLID:"lpCallId"},G=o().length,K=2083,J=u(),H=l(),B={},W={init:function(){if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax)try{lpTag.taglets.lpAjax.addTransport(A,W)}catch(e){}},configure:I,issueCall:E,isValidRequest:n,getVersion:function(){return C},getName:function(){return A},inspect:function(){return{name:A,version:C,callsMade:q,errorsFound:P,pending:w,baseUrl:L,defaults:function(){var e={};for(var t in k)k.hasOwnProperty(t)&&(e[t]=k[t]);return e}()}}};if(lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax)try{lpTag.taglets.lpAjax.addTransport(A,W)}catch(_){}return W}(),function(e){function t(e,t,r){lpTag&&lpTag.utils&&lpTag.utils.log&&lpTag.utils.log(e,t,r)}function r(e,t,r){var n=e&&e.body?e.body:null;return n||(n=e&&e.error?e.error:{error:{message:t,time:new Date,originalRequest:r}}),n}e.lpTag=e.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.utils=lpTag.utils||{};var n=lpTag.utils;n.runErrorCallback=function(e,t){e&&e.error&&lpTag.utils.runCallback(e.error,e,t),t=null,e=null},n.runSuccessCallback=function(e,t){e&&e.success&&lpTag.utils.runCallback(e.success,e,t)},n.runCallback=function(e,r,n){if(e&&"function"==typeof e)try{e.call(r.context||r,n)}catch(a){t("Failed to run callback, callback: "+e+" data: "+n,"error","lpTag.utils.runCallback")}},n.trim=function(e){return"string"==typeof e&&""!==e&&(e=e.replace(/^[\s*\n*\r*\t\*]*$[\s*\n*\r*\t\*]*/g,"")),e},n.getErrorData=function(e,t,n,a){e=r(e,t,n);for(var o in a)a.hasOwnProperty(o)&&!e[o]&&(e[o]=a[o]);return a=null,e},n.getResponseData=function(e,t,r,a){var o=e&&e.body?e.body:e;o=o||{};var i,s,u;if(t){u=t.split("."),s=u.length;for(var l=0;s>l&&(i=u[l],"undefined"!=typeof o[i]);l++)o=o[i];if(r===!0){var c={};c[u[s-1]]=o,o=c}}o=n.removeRels(o);for(var p in a)a.hasOwnProperty(p)&&"undefined"==typeof o[p]&&(o[p]=a[p]);return o},n.removeRels=function(e){for(var t in e)e.hasOwnProperty(t)&&("link"==t?(e[t]=null,delete e[t]):"object"==typeof e[t]&&(e[t]=lpTag.utils.removeRels(e[t])));return e},n.deleteProps=function(e,t){for(var r=0;r<t.length;r++)if(e.hasOwnProperty(t[r]))try{e[t[r]]=null,delete e[t[r]]}catch(n){}},n.hasProperties=function(e){var t=!1;if(e&&"object"==typeof e)for(var r in e)if(e.hasOwnProperty(r)){t=!0;break}return t}}(window),window.lpTag=window.lpTag||{},lpTag.taglets=lpTag.taglets||{},lpTag.utils=lpTag.utils||{},lpTag.utils.log=lpTag.utils.log||function(){},lpTag.utils.log.debug=!1,lpTag.taglets.ChatOverRestAPI=lpTag.taglets.ChatOverRestAPI||function(e){function t(){function t(){a&&(clearTimeout(a),a=null)}function r(){A({success:n,error:n}),o=(new Date).valueOf()}function n(){if(i){t();var e=(new Date).valueOf()-o;e=u-e,e>0?a=setTimeout(r,e):r()}}var a,o,i,s={inChat:2e3,exitSurvey:15e3},u=s.inChat,c=this;c.changeKeepAliveState=function(){t(),i=!ie&&(oe.chatInProgress||oe.exitSurveyOn),i&&(u=oe.chatInProgress?s.inChat:s.exitSurvey,r())},c.storeChatLocationURI=function(t,r){var n=l(Y.chat);e.sessionUID&&(n=l(e.sessionUID));var a={chatRel:t,location:window.location.href};if(r){a.overRides={};for(var o in r)r.hasOwnProperty(o)&&(a.overRides[o]=r[o])}j.setSessionData(n,a)},c.sessionEnded=function(){j.removeSessionData(l(Y.sessionVars)),j.removeSessionData(l(Y.chat)),j.removeSessionData(l(Y.resumeMode)),e.sessionUID&&j.removeSessionData(l(e.sessionUID))}}function r(n){lpTag.utils.Events&&lpTag.RelManager&&lpTag.SessionDataManager?(U=lpTag.utils.Events({cloneEventData:!0,eventBufferLimit:50}),M=new t,F=new lpTag.RelManager(n&&n.transportOrder),e=e||{},e.appName=G,j=new window.lpTag.utils.SessionDataAsyncWrapper(e),o()):20>Q&&setTimeout(r,500),Q++}function n(){return!!(B.lpNumber&&B.appKey&&B.domain)}function a(t,r){t&&(B.domain=t.clearDomain?te.trim(t.domain):te.trim(t.domain)||te.trim(B.domain)||"",B.lpNumber=te.trim(t.lpNumber)||te.trim(B.lpNumber)||"",B.appKey=te.trim(t.appKey)||te.trim(B.appKey)||"",e.sessionUID&&(B.sessionUID=e.sessionUID),B.lpNumber&&B.appKey&&B.domain&&(F.setData(B),"boolean"==typeof r&&!r||j.usingSecureStorage||j.setSessionData(l(Y.sessionVars),B)),z=t&&t.environment&&Z[t.environment]?t.environment:z,B.domain&&B.lpNumber&&f())}function o(){function t(e){for(var t in e)if(e.hasOwnProperty(t)&&0==String(t).indexOf("on")&&V.hasOwnProperty(t)){e[t]=e[t].constructor===Array?e[t]:[e[t]];for(var r=0;r<e[t].length;r++)"function"==typeof e[t][r]?V[t](e[t][r]):"object"==typeof e[t][r]&&e[t][r].callback&&"function"==typeof e[t][r].callback&&V[t](e[t][r].callback,e[t][r].appName||"",e[t][r].context||null)}}function r(){document.body?i():setTimeout(r,5)}function n(e){if(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n="undefined"!=typeof t[r],a=0==r.indexOf("on");n&&(t[r]===e[r]||a)?(t[r]=t[r].constructor===Array?t[r]:[t[r]],t[r].push(e[r])):t[r]=e[r]}}return t}V.onInit(function(e){e.error||(oe.initialised=!0)}),V.onStart(function(e){e.error||(oe.chatInProgress=!0)}),V.onState(function(e){if(!e.error)switch(oe.state=e.state,oe.state){case V.chatStates.CHATTING:case V.chatStates.WAITING:case V.chatStates.RESUMING:oe.state===V.chatStates.RESUMING||j.usingSecureStorage||j.setSessionData(l(Y.resumeMode),!0,null,null,null,!1),oe.chatInProgress=!0,M.changeKeepAliveState();break;case V.chatStates.INITIALISED:oe.chatInProgress=_?!0:!1;break;case V.chatStates.ENDED:case V.chatStates.UNINITIALISED:oe.chatInProgress=!1,M.changeKeepAliveState();break;case V.chatStates.NOTFOUND:oe.chatInProgress=!1,oe.exitSurveyOn=!1,M.changeKeepAliveState()}}),V.onVisitorName(function(e){e.error||(oe.visitorName=e.visitorName)}),V.onSetVisitorTyping(function(e){e.error||(oe.typing=e.typing)}),K=n(e),a(K,!1),t(K),"boolean"==typeof K.debug&&V.setDebugMode(K.debug),r()}function i(){e.doNotResume&&z!==Z.PRODUCTION?n()&&(R(),U.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:X,state:_?V.chatStates.RESUMING:V.chatStates.UNINITIALISED}}),oe.chatInProgress=!1):e.sessionUID?j.getSessionData(l(e.sessionUID),v,v,null):j.getSessionData(l(Y.resumeMode),d,d,null)}function s(e,t,r,n){if(!U)return!1;var a={eventName:e,appName:r||"",aSync:!1,func:t,context:n||null};return U.register(a)}function u(e,t,r,n){if(!U)return!1;"function"==typeof e?(r=e,e=""):"object"==typeof e&&(n=e,e="");var a={eventName:e,appName:t||"",func:r,context:n||null};return U.unbind(a)}function l(t){if(!e.lpNumber)return"";if("object"==typeof t){var r=[];for(var n in t)t.hasOwnProperty(n)&&r.push(t[n]+e.lpNumber);return r}return t+e.lpNumber}function c(e,t,r,n){return p(ee.ERROR,{error:e,originalRequest:t,sentRequest:r,response:n}),t=null,r=null,n=null,e}function p(e,t){var r={eventName:"onLog"};return e&&"string"==typeof e?r.appName=e:"object"==typeof e&&(t=e),r.data=t,r.appName&&r.appName!==ee.ERROR&&!W?void(r=null):(U.publish(r),void(r=null))}function f(){ne.configureTransports({rest2jsonp:{domain:B.domain,site:B.lpNumber},postmessage:{frames:[{url:"https://"+B.domain+$(),delayLoad:0}]}})}function d(e){e===!0||"true"===e?j.getSessionData(l(Y.sessionVars),m,m,null):g()}function g(){oe.chatInProgress=!1,_=!1,U.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:X,state:_?V.chatStates.RESUMING:V.chatStates.UNINITIALISED}}),R()}function m(t){t&&"object"==typeof t&&!t.error?h(e,t)&&(a(t),_=!0,j.getSessionData(l(Y.chat),v,v,null)):g()}function v(e){!e||e&&!e.chatRel?g():(oe.chatInProgress=!0,U.publish({eventName:"onLoad",data:{API:"Chat API SDK Loaded",version:X,state:_?V.chatStates.RESUMING:V.chatStates.UNINITIALISED}}),e.overRides&&a(e.overRides),R({success:function(){F.addRels({link:[{rel:"location",href:e.chatRel}]},{type:"chat"}),x(w(V.chatStates.RESUMING,new Date)),I(null,e.overRides)},error:function(){M.sessionEnded()}}))}function h(e,t){for(var r=["lpNumber","appKey","sessionUID"],n=!0,a=0;a<r.length;a++){var o=r[a];if(e[o]!=t[o]&&("sessionUID"===o?e[o]&&t[o]&&(n=!1):n=!1),!n)break}return n}function y(e,t,r,n,a,o){p(ee.ERROR,{originalRequest:e,sentRequest:t,response:r}),r=te.getErrorData(r,a,e),n=n.constructor===Array?n:[n];for(var i=0;i<n.length;i++)U.publish({eventName:n[i],appName:o||"",data:r});return te.runErrorCallback(e,r),t=null,r}function T(e){var t={site:e.lpNumber};t.success=function(t){e.domain=t.domain,R(e)},t.error=function(t){c({error:"unable to resolve site domain"},e,"",t),y({},{},{},"onInit","unable to initiate session"),te.runErrorCallback(e)},V.getSiteDomain(t)}function R(e){if(e=e||{},a(e),e.lpNumber=B.lpNumber,e.appKey=B.appKey,e.domain=B.domain,!e.lpNumber)return c({error:"missing site configuration data, cannot _init"},e,"","");if(!e.domain)return T(e),!1;if(!n())return!1;F.setData(e);var t=F.buildRequestObj({rel:"",data:{lpNumber:B.lpNumber,appKey:B.appKey,domain:B.domain}});return t.success=function(r){p(ee.INFO,{originalRequest:e,sentRequest:t,response:r}),r&&(F.addRels(r,{type:"chat"}),N("self",{type:"chat",ignoreParameters:!0},[{rel:"OTK",href:"chat/resumeWithOTK"}]),U.publish({eventName:"onInit",data:{account:e.lpNumber,domain:e.domain,init:!0}}),x(w(V.chatStates.INITIALISED))),e.requestChat?V.requestChat(e):te.runSuccessCallback(e,{}),t=null},t.error=function(r){var n=["onInit"];e.requestChat&&n.push("onRequestChat"),y(e,t,r,n,"unable to initiate session"),F.clearData()},p(ee.INFO,{originalRequest:e,sentRequest:t,response:"SENDING REQUEST"}),ne.issueCall(t)}function b(e){var t,r={},e=e||{};e.agent?(r.agent=e.agent,te.deleteProps(e,["skill","serviceQueue","maxWaitTime"])):e.skill?(r.skill=e.skill,te.deleteProps(e,["serviceQueue"])):e.serviceQueue&&!isNaN(e.maxWaitTime)&&(r.serviceQueue=e.serviceQueue),!isNaN(e.maxWaitTime)&&e.maxWaitTime>=0&&e.maxWaitTime<86400&&(r.maxWaitTime=e.maxWaitTime),"string"==typeof e.buttonName?r.chatReferrer="(button dynamic-button:"+e.buttonName+"()) "+document.location.href:e.invitation===!0?r.chatReferrer="(engage) "+document.location.href:(e.chatReferrer||document.referrer)&&(r.chatReferrer=e.chatReferrer||document.referrer),navigator&&navigator.userAgent&&(r.userAgent=navigator.userAgent),"string"==typeof e.ssoKey&&(r.ssoKey=e.ssoKey),"object"==typeof e.survey&&(r.survey=e.survey),e.a2aSourceSiteId&&(r.a2aSourceSiteId=e.a2aSourceSiteId),e.a2aSourceSessionId&&(r.a2aSourceSessionId=e.a2aSourceSessionId),e.a2aEventId&&(r.a2aEventId=e.a2aEventId),"string"==typeof e.LETagVisitorId&&(r.LETagVisitorId=e.LETagVisitorId),"string"==typeof e.LETagSessionId&&(r.LETagSessionId=e.LETagSessionId),"string"==typeof e.LETagContextId&&(r.LETagContextId=e.LETagContextId),e.runWithRules===!0&&(r.runWithRules=!0);var n=e.visitorId||j.readCookie(K.lpNumber+"-VID");n&&(r.visitorId=n);var a=e.visitorSessionId||j.readCookie(K.lpNumber+"-SKEY")||window.lpMTagConfig&&window.lpMTagConfig.LPSID_VAR;if(a&&(r.visitorSessionId=a),"object"==typeof e.customVariables)if(e.customVariables.customVariable&&e.customVariables.customVariable.constructor===Array)r.customVariables=e.customVariables;else{var o=S(e.customVariables);o&&(r.customVariables=o)}return e.preChatLines&&e.preChatLines.constructor===Array&&(r.preChatLines={line:e.preChatLines}),"string"==typeof e.ssoServiceExtraParams&&(r.ssoServiceExtraParams=e.ssoServiceExtraParams),"string"==typeof e.ssoServiceKey&&(r.ssoServiceKey=e.ssoServiceKey),"undefined"!=typeof e.engagementId&&(r.engagementId=e.engagementId),"undefined"!=typeof e.campaignId&&(r.campaignId=e.campaignId),"string"==typeof e.language&&(r.language=e.language),t=V.getRtSessionId(),t&&(r.rtSessionId=t),te.hasProperties(r)?{request:r}:{}}function S(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push({name:r,value:e[r]});return t.length>0?{customVariable:t}:null}function N(e,t,r){for(var n=F.getURI(e,t),a={link:[]},o=0;o<r.length;o++)a.link.push({href:n+"/"+r[o].href,rel:""+r[o].rel});F.addRels(a,t)}function E(e,t){if(oe.chatInProgress||ae)return!1;var r={},n=e&&e.siteContainer||window.lpMTagConfig&&window.lpMTagConfig.FPC_CONT||j.readCookie("HumanClickSiteContainerID_"+K.lpNumber);n&&(r.siteContainer=n);var a=F.buildRequestObj({rel:"chat-request",type:"chat",needAuth:!0,requestType:"POST",data:b(e),queryParams:r});return a?(O(e.sessionUID),ae=!0,a.success=function(r){p(ee.INFO,{originalRequest:e||"",sentRequest:a,response:r}),r&&r.headers&&r.headers.Location&&(F.addRels({link:[{"@rel":"location","@href":r.headers.Location}]},{type:"chat"}),M.storeChatLocationURI(r.headers.Location,t),t&&(oe.initialised=!1),I(e)),a=null},a.error=function(t){y(e,a,t,["onRequestChat"],"requestChat  - server error"),ae=!1},p(ee.INFO,{originalRequest:e||"",sentRequest:a,response:"SENDING REQUEST"}),ne.issueCall(a)):c({error:"requestChat - unable to find rel for request"},"","","")}function O(t){t&&(e=e||{},e.sessionUID&&V.clearSessionData(e.sessionUID),e.sessionUID=t)}function I(e,t){var r=F.buildRequestObj({rel:"location",type:"chat",needAuth:!0,requestType:"GET"});return r?(ae=!0,r.success=function(n){p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:n}),C(r,e,n),t&&(oe.initialised=!1),ae=!1,r=null},r.error=function(t){oe.chatState===V.chatStates.RESUMING&&(x(w(V.chatStates.NOTFOUND)),M.sessionEnded()),y(e,r,t,"onRequestChat","_getSessionData  - server error"),ae=!1},p(ee.INFO,{originalRequest:"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"_getSessionData - unable to find rel for request"},"","","")}function C(e,t,r){if(r){F.addRels(r.body.chat,{type:"chat"}),F.addRels(r.body.chat.info,{type:"visitor"});var n=te.getResponseData(r,"chat",!1);U.publish({eventName:"onRequestChat",data:n}),k(n.info);var a=L(n.events);a&&q(a),te.runSuccessCallback(t,n),_=!1}e=null}function D(e){for(var t={},r=0;r<e.length;r++)t[e[r].skill]=e[r].isAvailable;return t}function A(e){var t=F.buildRequestObj({rel:"next",type:"chat",needAuth:!0,requestType:"GET"});return t?(t.timeout=1e4,t.retries=0,t.success=function(r){J=0;var n,a;p(ee.INFO,{originalRequest:"",sentRequest:t,response:r}),r&&(F.addRels(r.body.chat,{type:"chat"}),F.addRels(r.body.chat.info,{type:"visitor"}),n=te.getResponseData(r,"chat"),a=L(n.events),a&&q(a),n.info&&k(n.info)),te.runSuccessCallback(e,a),t=null},t.error=function(r){J+=1,r=y(e,t,r,["onLine","onAgentTyping","onInfo","onEvents"],"_getEvents - server error"),(J>H||r&&r.error&&12===r.error.internalCode)&&x(w(V.chatStates.NOTFOUND))},p(ee.INFO,{originalRequest:"",sentRequest:t,response:"SENDING REQUEST"}),ne.issueCall(t)):c({error:"_getEvents - unable to find rel for request"},"","","")}function q(e){if(e.line&&U.publish({eventName:"onLine",data:{lines:e.line}}),e["a2a-transfer"]){var t=P(e["a2a-transfer"]);U.publish({eventName:"onAccountToAccountTransfer",data:t})}e.collaboration&&U.publish({eventName:"onCollaboration",data:{collaboration:e.collaboration}}),e.state&&(e.state=e.state.constructor===Array?e.state.pop():e.state,x(w(e.state.state,e.state.time))),U.publish({eventName:"onEvents",data:e})}function P(e){return e.length>1?e[e.length-1]:e[0]}function w(e,t){return{state:e,time:t||(new Date).toTimeString()}}function k(e){"typing"===e.agentTyping!=oe.agentTyping&&(oe.agentTyping="typing"===e.agentTyping,U.publish({eventName:"onAgentTyping",data:{agentTyping:oe.agentTyping}}),e.agentTyping=null,delete e.agentTyping);var t=!1;for(var r in e)e.hasOwnProperty(r)&&oe.hasOwnProperty(r)&&e[r]!=oe[r]&&"lastUpdate"!==r&&"agentTyping"!==r&&"visitorTyping"!==r&&"state"!==r&&(oe[r]=e[r],t=!0);oe.state==V.chatStates.RESUMEPAUSEDCHAT&&e.state!==oe.state&&x(w(e.state)),oe.lastUpdate=e.lastUpdate,t&&U.publish({eventName:"onInfo",data:oe,cloneEventData:!0})}function x(e){if(oe.chatState!==e.state){switch(oe.chatState=e.state,e.state){case V.chatStates.ENDED:U.publish({eventName:"onStop",data:e});break;case V.chatStates.CHATTING:U.publish({eventName:"onStart",data:e})}U.publish({eventName:"onState",data:e})}}function L(e){if(!e.event)return null;e=e.event,e=e.constructor===Array?e:[e];for(var t={},r=!1,n=0;n<e.length;n++){var a=e[n].type||e[n]["@type"];if(e[n].channelID){var o=e[n].channelID;t[a]=t[a]||{},t[a][o]=t[a][o]||[],t[a][o].push(e[n])}else t[a]=t[a]||[],t[a].push(e[n]);r=!0}return r?t:null}if(this===window)return!1;var U,M,F,j,V=this,G="ChatOverRestAPI",K={},J=0,H=e&&e.failureTolerance||9,B={},W=!1,_=!1,Q=0,X="1.1.5",Y={resumeMode:"lpVisitorResumeMode",sessionVars:"lpVisitorSessionVars",chat:"lpVisitorChatRels",sessionUID:"lpSessionUID"},Z={QA:"QA",DEV:"DEV",PRODUCTION:"PRODUCTION",CI:"CI",CLOUD:"CLOUD"},z=Z.PRODUCTION,$=function(){return z!=Z.PRODUCTION?"/hcp/html/lpsunco/postmessage.html":"/hcp/html/postmessage.min.html"},ee={ERROR:"ERROR",INFO:"INFO"},te=lpTag.utils,re=lpTag&&lpTag.taglets&&lpTag.taglets.jsonp,ne=lpTag&&lpTag.taglets&&lpTag.taglets.lpAjax,ae=!1,oe={typing:!1,visitorName:"",agentName:"",rtSessionId:"",initialised:!1,agentTyping:!1,chatInProgress:!1,visitorId:"",agentId:"",timeout:"",chatSessionKey:"",chatState:"",exitSurveyOn:!1},ie=!1;V.getSiteDomain=function(e){var t="https://api.liveperson.net/csdr/account/",r="/service/adminArea/baseURI.lpCsds?version=1.0";if("function"!=typeof e.success||!e.site)return c({error:"missing callback or site - cannot lookup domain"},"","","");var n={url:t+e.site+r};return n.success=function(t){var r;if(p(ee.INFO,{originalRequest:{site:e.site},sentRequest:n,response:t}),t&&t.ResultSet&&t.ResultSet.lpData)for(var a=t.ResultSet.lpData,o=0;o<a.length;o++)!r&&a[o].lpServer&&(r=a[o].lpServer);n=null,r?te.runSuccessCallback(e,{domain:r,site:e.site}):te.runErrorCallback(e,{error:"unable to resolve site domain",response:t,site:e.site})},n.error=n.success,p(ee.INFO,{originalRequest:{site:e.site},sentRequest:n,response:"SENDING REQUEST"}),re.issueCall(n)},V.requestChat=function(t){oe.initialised?E(t):(t=t||{},t.requestChat=!0,t.lpNumber=e.lpNumber,t.appKey=e.appKey,t.domain=e.domain||null,t.clearDomain=!0,R(t))},V.startChat=V.requestChat,V.reInit=function(t){oe={typing:!1,visitorName:"",agentName:"",rtSessionId:"",initialised:!1,agentTyping:!1,chatInProgress:!1,visitorId:"",agentId:"",timeout:"",chatSessionKey:"",chatState:"",exitSurveyOn:!1},t&&(t.disposeVisitor===!0&&V.disposeVisitor(),t.sessionUID&&(e=e||{},e.sessionUID=t.sessionUID)),F.clearData(),i()},V.getAvailableSlots=function(e){var t={};e&&(e.agent&&"string"==typeof e.agent?t.agent=e.agent:(e.skill&&"string"==typeof e.skill&&(t.skill=e.skill),"number"==typeof e.maxWaitTime&&(t.maxWaitTime=e.maxWaitTime)));var r=F.buildRequestObj({rel:"chat-available-slots",type:"chat",needAuth:!0,requestType:"GET",queryParams:t});return r?(r.success=function(t){if(p(ee.INFO,{
originalRequest:e||"",sentRequest:r,response:t}),t){var n=te.getResponseData(t,"availableSlots",!0);U.publish({eventName:"onAvailableSlots",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onAvailableSlots","getAvailableSlots - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getAvailableSlots - unable to find rel for request"},"","","")},V.getEstimatedWaitTime=function(e){var t={};e&&(e.skill&&"string"==typeof e.skill&&(t.skill=e.skill),e.serviceQueue&&"string"==typeof e.serviceQueue&&(t.serviceQueue=e.serviceQueue));var r=F.buildRequestObj({rel:"chat-estimatedWaitTime",type:"chat",needAuth:!0,requestType:"GET"});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:"",sentRequest:r,response:t}),t){var n=te.getResponseData(t,"estimatedWaitTime",!0);U.publish({eventName:"onEstimatedWaitTime",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onEstimatedWaitTime","getEstimatedWaitTime - server error")},p(ee.INFO,{originalRequest:"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getEstimatedWaitTime - unable to find rel for request"},"","","")},V.getAvailabilty=function(e){var t={};e&&(e.agent&&"string"==typeof e.agent?t.agent=e.agent:(!e.skill||"string"!=typeof e.skill&&e.skill.constructor!==Array||(t.skill=e.skill),"number"==typeof e.maxWaitTime&&(t.maxWaitTime=e.maxWaitTime)));var r=F.buildRequestObj({rel:"chat-availability",type:"chat",needAuth:!0,requestType:"GET",queryParams:t});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),t){var n=te.getResponseData(t,"availability",!0);n.availability&&n.availability.AvailabilityForSkills&&n.availability.AvailabilityForSkills.skillAvailability&&(n=D(n.availability.AvailabilityForSkills.skillAvailability)),U.publish({eventName:"onAvailability",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onAvailability","getAvailabilty - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getAvailability - unable to find rel for request"},"","","")},V.getAvailability=V.getAvailabilty,V.disposeVisitor=function(){M.sessionEnded(),U.publish({eventName:"onVisitorDisposed",data:{visitorDisposed:!0,aSync:!0}})},V.clearSessionData=function(e){return e?(j.removeSessionData(l(e)),!0):!1},V.getPreChatSurvey=function(e){var t={};e&&(e.visitorProfile&&"string"==typeof e.visitorProfile?t.visitorProfile=e.visitorProfile:e.skill&&"string"==typeof e.skill&&(t.skill=e.skill)),e.visitorIp&&"string"==typeof e.visitorIp&&(t.visitorIp=e.visitorIp),e.surveyName&&"string"==typeof e.surveyName?t.surveyName=e.surveyName:e.surveyApiId&&(t.surveyApiId=e.surveyApiId);var r=F.buildRequestObj({rel:"prechat-survey",type:"chat",needAuth:!0,requestType:"GET",queryParams:t});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),t){var n=te.getResponseData(t,"survey",!0);U.publish({eventName:"onPreChatSurvey",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onPreChatSurvey","getPreChatSurvey - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getPreChatSurvey - unable to find rel for request"},"","","")},V.getOfflineSurvey=function(e){var t={};e&&(e.skill&&"string"==typeof e.skill?t.skill=e.skill:e.visitorProfile&&"string"==typeof e.visitorProfile?t.visitorProfile=e.visitorProfile:e.visitorId&&"string"==typeof e.visitorId?t.visitorId=e.visitorId:e.surveyName&&"string"==typeof e.surveyName?t.surveyName=e.surveyName:e.surveyApiId&&(t.surveyApiId=e.surveyApiId));var r=F.buildRequestObj({rel:"chat-offline-survey",type:"chat",needAuth:!0,requestType:"GET",queryParams:t});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),t){var n=te.getResponseData(t,"survey",!0);U.publish({eventName:"onOfflineSurvey",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onOfflineSurvey","getOfflineSurvey - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getOfflineSurvey - unable to find rel for request"},"","","")},V.submitOfflineSurvey=function(e){var t,r={};if(!e.survey)return c({error:"Survey must be present in order to submit"},"","","");r.survey=e.survey,t=e.visitorSessionId||j.readCookie(K.lpNumber+"-SKEY")||window.lpMTagConfig&&window.lpMTagConfig.LPSID_VAR,t&&(r.survey.visitorSessionId=t),"string"==typeof e.LETagVisitorId&&(r.survey.LETagVisitorId=e.LETagVisitorId),"string"==typeof e.LETagSessionId&&(r.survey.LETagSessionId=e.LETagSessionId),"string"==typeof e.LETagContextId&&(r.survey.LETagContextId=e.LETagContextId);var n=e.visitorId||j.readCookie(K.lpNumber+"-VID");n&&(r.survey.visitorId=n);var a=F.buildRequestObj({rel:"chat-offline-survey",type:"chat",needAuth:!0,requestType:"PUT",data:r});return a?(a.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:a,response:t}),t){var r=te.getResponseData(t);U.publish({eventName:"onSubmitOfflineSurvey",data:r}),te.runSuccessCallback(e,r)}a=null},a.error=function(t){y(e,a,t,"onSubmitOfflineSurvey","submitOfflineSurvey - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:a,response:"SENDING REQUEST"}),ne.issueCall(a)):c({error:"submitOfflineSurvey - unable to find rel for request"},"","","")},V.pauseChat=function(){ie=!0,x(w(V.chatStates.PAUSECHAT)),M.changeKeepAliveState()},V.resumePausedChat=function(){ie=!1,x(w(V.chatStates.RESUMEPAUSEDCHAT)),M.changeKeepAliveState()},V.setCustomVariable=function(e){if(!e.customVariable)return c({error:"setCustomVariable - no variables passed in"},"","","");var t=S(e.customVariable);if(!t||!t.customVariable)return c({error:"setCustomVariable - unable to find any custom variables to set"},"","","");e.customVariable=t.customVariable;var r=F.buildRequestObj({rel:"custom-variables",type:"chat",needAuth:!0,requestType:"PUT",data:{customVariables:{customVariable:e.customVariable}}});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),t){var n={customVariable:e.customVariable};U.publish({eventName:"onSetCustomVariable",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onSetCustomVariable","setCustomVariable  - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"setCustomVariable - unable to find rel for request"},"","","")},V.requestTranscript=function(e){var t=new RegExp(/[a-zA-Z0-9.-_]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);if("string"==typeof e&&(e={email:e}),!e.email||!t.test(e.email))return c({error:"requestTranscriptEmail - no variables passed in or invalid email"},"","","");var r=F.buildRequestObj({rel:"transcript-request",type:"chat",needAuth:!0,requestType:"PUT",data:{email:e.email}});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),t){var n={email:e.email};U.publish({eventName:"onTranscript",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onTranscript","requestTranscriptEmail  - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"requestTranscript - unable to find rel for request"},"","","")},V.getExitSurvey=function(e){var t={};e&&e.surveyName?t.surveyName=e.surveyName:e&&e.surveyApiId&&(t.surveyApiId=e.surveyApiId);var r=F.buildRequestObj({rel:"exit-survey",type:"chat",needAuth:!0,requestType:"GET",queryParams:t});return r?(r.success=function(t){p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t});var n={};t&&t.body&&t.body.survey&&(oe.exitSurveyOn=!0,M.changeKeepAliveState(),n=te.getResponseData(t,"survey",!0),U.publish({eventName:"onExitSurvey",data:n}),te.runSuccessCallback(e,n)),r=null},r.error=function(t){oe.exitSurveyOn=!1,M.changeKeepAliveState(),y(e,r,t,"onExitSurvey","getExitSurvey  - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"getExitSurvey - unable to find rel for request"},"","","")},V.submitExitSurvey=function(e){var t={};if(!e.survey)return c({error:"submitExitSurvey - no survey passed in"},"","","");t.survey=e.survey.survey?e.survey.survey:e.survey,document.referrer&&(t.survey.chatReferrer=document.referrer),navigator&&navigator.userAgent&&(t.survey.userAgent=navigator.userAgent);var r=F.buildRequestObj({rel:"exit-survey",type:"chat",needAuth:!0,requestType:"PUT",data:t});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:t}),oe.exitSurveyOn=!1,M.changeKeepAliveState(),t){var n=te.getResponseData(t);U.publish({eventName:"onSubmitExitSurvey",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(t){y(e,r,t,"onSubmitExitSurvey","submitExitSurvey  - server error")},p(ee.INFO,{originalRequest:e||"",sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"submitExitSurvey - unable to find rel for request"},"","","")},V.addLine=function(e){if(!e)return c({error:"No object data passed"},"","","");if(!e.text)return c({error:"No text to send"},e,"","");var t=F.buildRequestObj({rel:"events",needAuth:!0,type:"chat",requestType:"POST",data:{event:{"@type":"line",text:e.text}}});return t?(t.success=function(r){if(p(ee.INFO,{originalRequest:e,sentRequest:t,response:r}),r){var n={text:e.text};U.publish({eventName:"onAddLine",data:n}),te.runSuccessCallback(e,n)}t=null},t.error=function(r){y(e,t,r,"onAddLine","addLine  - server error")},p(ee.INFO,{originalRequest:e,sentRequest:t,response:"SENDING REQUEST"}),ne.issueCall(t)):c({error:"addLine - unable to find rel for request"},e,"","")},V.setVisitorTyping=function(e){if(!e)return c({error:"No object data passed"},"","","");if("boolean"!=typeof e.typing||e.typing==oe.typing)return c({error:"setVisitorTyping typing status missing, not a boolean or unchanged from previous update"},e,"","");oe.typing=e.typing;var t=F.buildRequestObj({rel:"visitor-typing",needAuth:!0,type:"visitor",requestType:"PUT",data:{visitorTyping:e.typing?"typing":"not-typing"}});return t?(t.success=function(r){if(p(ee.INFO,{originalRequest:e,sentRequest:t,response:r}),r){var n={typing:e.typing};U.publish({eventName:"onSetVisitorTyping",data:n}),te.runSuccessCallback(e,n)}t=null},t.error=function(r){y(e,t,r,"onSetVisitorTyping","setVisitorTyping  - server error")},p(ee.INFO,{originalRequest:e,sentRequest:t,response:"SENDING REQUEST"}),ne.issueCall(t)):c({error:"setVisitorTyping - unable to find rel for request"},e,"","")},V.endChat=function(e){var t=F.buildRequestObj({rel:"events",type:"chat",needAuth:!0,requestType:"POST",data:{event:{"@type":"state",state:V.chatStates.ENDED}}});return t&&oe.chatInProgress?(t.success=function(r){if(p(ee.INFO,{originalRequest:e,sentRequest:t,response:r}),r){var n=w(V.chatStates.ENDED);x(n),te.runSuccessCallback(e,n)}t=null},t.error=function(r){y(e,t,r,["onState"],"endChat - server error")},e&&e.disposeVisitor&&V.disposeVisitor(),p(ee.INFO,{originalRequest:e,sentRequest:t,response:"SENDING REQUEST"}),ne.issueCall(t)):c({error:"endChat - unable to find rel for request, or chat not active"},e,"","")},V.setVisitorName=function(e){if(!e)return c({error:"No object data passed"},"","","");var t="";if("string"!=typeof e.visitorName||e.visitorName==oe.visitorName)return c({error:"setVisitorName missing visitorName or unchanged from previous update"},e,"","");t=oe.visitorName,oe.visitorName=e.visitorName;var r=F.buildRequestObj({rel:"visitor-name",needAuth:!0,type:"visitor",requestType:"PUT",data:{visitorName:e.visitorName}});return r?(r.success=function(t){if(p(ee.INFO,{originalRequest:e,sentRequest:r,response:t}),t){var n={visitorName:e.visitorName};U.publish({eventName:"onVisitorName",data:n}),te.runSuccessCallback(e,n)}r=null},r.error=function(n){oe.visitorName=t,y(e,r,n,"onVisitorName","setVisitorName  - server error")},p(ee.INFO,{originalRequest:e,sentRequest:r,response:"SENDING REQUEST"}),ne.issueCall(r)):c({error:"setVisitorName - unable to find rel for request"},e,"","")},V.getAgentTyping=function(){return oe.agentTyping},V.getVisitorName=function(){return oe.visitorName},V.getState=function(){return oe.state},V.getAgentLoginName=function(){return oe.agentName},V.getAgentId=function(){return oe.agentId},V.getRtSessionId=function(){return oe.rtSessionId},V.getConfig=function(){var e={};for(var t in K)K.hasOwnProperty(t)&&(e[t]=K[t]);return e},V.getSessionKey=function(){return oe.chatSessionKey},V.setDebugMode=function(e){"boolean"==typeof e&&(W=e,lpTag.utils.log.debug=e)},V.onLoad=function(e,t,r){return s("onLoad",e,t||"",r)},V.onInit=function(e,t,r){return s("onInit",e,t||"",r)},V.onStart=function(e,t,r){return s("onStart",e,t||"",r)},V.onRequestChat=function(e,t,r){return s("onRequestChat",e,t||"",r)},V.onTransferChat=function(e,t,r){return s("onTransferChat",e,t||"",r)},V.onAvailableSkills=function(e,t,r){return s("onAvailableSkills",e,t||"",r)},V.onAvailability=function(e,t,r){return s("onAvailability",e,t||"",r)},V.onEstimatedWaitTime=function(e,t,r){return s("onEstimatedWaitTime",e,t||"",r)},V.onAgentTyping=function(e,t,r){return s("onAgentTyping",e,t||"",r)},V.onUrlPush=function(e,t,r){return s("onUrlPush",e,t||"",r)},V.onLine=function(e,t,r){return s("onLine",e,t||"",r)},V.onInfo=function(e,t,r){return s("onInfo",e,t||"",r)},V.onEvents=function(e,t,r){return s("onEvents",e,t||"",r)},V.onState=function(e,t,r){return s("onState",e,t||"",r)},V.onStop=function(e,t,r){return s("onStop",e,t||"",r)},V.onResume=function(e,t,r){return s("onResume",e,t||"",r)},V.onAccountToAccountTransfer=function(e,t,r){return s("onAccountToAccountTransfer",e,t||"",r)},V.onAddLine=function(e,t,r){return s("onAddLine",e,t||"",r)},V.onVisitorName=function(e,t,r){return s("onVisitorName",e,t||"",r)},V.onSetVisitorTyping=function(e,t,r){return s("onSetVisitorTyping",e,t||"",r)},V.onEstimatedChatWaitTime=function(e,t,r){return s("onEstimatedChatWaitTime",e,t||"",r)},V.onAvailableSlots=function(e,t,r){return s("onAvailableSlots",e,t||"",r)},V.onTranscript=function(e,t,r){return s("onTranscript",e,t||"",r)},V.onPreChatSurvey=function(e,t,r){return s("onPreChatSurvey",e,t||"",r)},V.onOfflineSurvey=function(e,t,r){return s("onOfflineSurvey",e,t||"",r)},V.onSubmitOfflineSurvey=function(e,t,r){return s("onSubmitOfflineSurvey",e,t||"",r)},V.onExitSurvey=function(e,t,r){return s("onExitSurvey",e,t||"",r)},V.onLog=function(e,t,r){return s("onLog",e,t||"",r)},V.onVisitorDisposed=function(e,t,r){return s("onVisitorDisposed",e,t||"",r)},V.onError=function(e,t,r){return s("onError",e,t||"",r)},V.unbind=function(e,t,r,n){return u(e,t,r,n)},r(e)},lpTag.taglets.ChatOverRestAPI.prototype.chatStates={CHATTING:"chatting",WAITING:"waiting",ENDED:"ended",RESUMING:"resume",UNINITIALISED:"uninitialised",INITIALISED:"initialised",NOTFOUND:"notfound",PAUSECHAT:"paused",RESUMEPAUSEDCHAT:"resumepaused"},lpTag.taglets.ChatOverRestAPI.prototype.connectionStates={ACTIVE:"active",INACTIVE:"inactive"};